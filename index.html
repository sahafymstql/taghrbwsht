<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<link rel="icon" href="https://qaryat.xyz/wp-content/uploads/file_00000000525c61f8afbbc7b590d1c6ef_1749847919915.jpeg">

<title>ğŸ§ Ù…ÙƒØªØ¨Ø© ØªØ§ØºØ±Ø¨ÙˆØ´Øª Ø§Ù„ØµÙˆØªÙŠØ©</title>

<style>
body{
  font-family:'Tajawal',sans-serif;
  background:#f5f7ff;
  color:#222;
  margin:0;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

header{
  text-align:center;
  padding:20px 12px;
  background:#2563eb;
  color:#fff;
  font-size:1.6rem;
  font-weight:700;
}

main{
  flex:1;
  padding:12px;
  padding-bottom:110px;
}

#backBtn{
  margin:12px;
  display:none;
  background:#2563eb;
  color:#fff;
  padding:11px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  width:calc(100% - 24px);
}

#searchInput{
  display:none;
  margin:0 12px 15px;
  padding:12px;
  width:calc(100% - 24px);
  border:1px solid #ccc;
  border-radius:10px;
}

#listContainer{
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
.item-card{
  background:#fff;
  border-radius:14px;
  padding:14px 12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  border:1px solid #e5e7eb;
  box-shadow:0 3px 10px rgba(0,0,0,.06);
  transition:.2s;
}

.item-card:hover{
  background:#eef3ff;
}

/* ØªÙ…ÙŠÙŠØ² Ø®ÙÙŠÙ ÙÙ‚Ø· Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø´Ø· */
.item-card.active{
  background:#eef3ff;
  border-color:#2563eb;
}

.play-button{
  background:#2563eb;
  color:#fff;
  padding:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.message{
  text-align:center;
  padding:40px;
  color:#555;
}

/* Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª */
#audioPlayerContainer{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#1d4ed8;
  padding:12px;
  transform:translateY(100%);
  transition:.35s;
  color:#fff;
  border-radius:15px 15px 0 0;
}

#audioPlayerContainer.active{
  transform:translateY(0);
}

.audio-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
}

audio{
  width:100%;
}
</style>
</head>

<body>

<header>ğŸ§ Ù…ÙƒØªØ¨Ø© ØªØ§ØºØ±Ø¨ÙˆØ´Øª Ø§Ù„ØµÙˆØªÙŠØ©</header>

<button id="backBtn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
<input id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‚Ø·Ø¹ ØµÙˆØªÙŠ...">

<main>
  <div id="listContainer" class="message">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</main>

<div id="audioPlayerContainer">
  <div class="audio-header">
    <div id="audioFileName"></div>
    <button id="closePlayerBtn">&times;</button>
  </div>
  <audio controls></audio>
</div>


<script>
const apiUrl='https://qaryat.xyz/list_audio.php';

const listContainer=document.getElementById('listContainer');
const backBtn=document.getElementById('backBtn');
const searchInput=document.getElementById('searchInput');
const audioContainer=document.getElementById('audioPlayerContainer');
const audioElem=audioContainer.querySelector('audio');
const audioNameElem=document.getElementById('audioFileName');
const closeBtn=document.getElementById('closePlayerBtn');

let currentFolder='';
let audioFiles=[];
let currentIndex=-1;


/* ===== Ø£Ø¯ÙˆØ§Øª ØµØºÙŠØ±Ø© ===== */

function normalize(s){
  return s.toLowerCase().replace(/[Ø£Ø¥Ø¢]/g,'Ø§');
}

function setActive(index){
  document.querySelectorAll('.item-card')
    .forEach((c,i)=>c.classList.toggle('active', i===index));
}


/* ===== ØªØ­Ù…ÙŠÙ„ ===== */

function loadContent(folder=''){

  currentFolder=folder;

  backBtn.style.display=folder?'block':'none';
  searchInput.style.display=folder?'block':'none';
  searchInput.value='';

  listContainer.innerHTML='<div class="message">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

  const url=folder?`${apiUrl}?folder=${encodeURIComponent(folder)}`:apiUrl;

  fetch(url)
  .then(r=>r.json())
  .then(data=>{

    listContainer.innerHTML='';

    if(!data.length){
      listContainer.innerHTML='<div class="message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±</div>';
      return;
    }

    if(!folder){

      data.filter(i=>i.type==='folder').forEach(f=>{
        const div=document.createElement('div');
        div.className='item-card';
        div.textContent='ğŸ“ '+f.name;
        div.onclick=()=>loadContent(f.path);
        listContainer.appendChild(div);
      });

    }else{

      audioFiles=data.filter(i=>i.type==='file' && /\.(mp3|wav|ogg)$/i.test(i.name));
      renderAudioList(audioFiles);
    }
  });
}


/* ===== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª ===== */

function renderAudioList(files){

  listContainer.innerHTML='';

  files.forEach((f,index)=>{

    const div=document.createElement('div');
    div.className='item-card';

    div.innerHTML=`
      <span><i class="fa-solid fa-music"></i> &nbsp; ${f.name}</span>
      <button class="play-button"><i class="fa-solid fa-play"></i></button>
    `;

    /* Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙƒÙ„Ù‡Ø§ */
    div.onclick=()=>playAudio(f.url,f.name,index);

    /* Ø§Ù„Ø²Ø± Ø£ÙŠØ¶Ø§ */
    div.querySelector('.play-button').onclick=(e)=>{
      e.stopPropagation();
      playAudio(f.url,f.name,index);
    };

    listContainer.appendChild(div);
  });
}


/* ===== ØªØ´ØºÙŠÙ„ ===== */

function playAudio(url,name,index){

  currentIndex=index;

  audioElem.pause();
  audioElem.currentTime=0;

  audioElem.src=url;
  audioElem.play().catch(()=>{});

  audioNameElem.textContent=name;

  setActive(index);

  audioContainer.classList.add('active');
}


/* Ø§Ù„ØªØ§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ */
audioElem.onended=()=>{
  if(audioFiles[currentIndex+1]){
    const next=audioFiles[currentIndex+1];
    playAudio(next.url,next.name,currentIndex+1);
  }
};


/* Ø¨Ø­Ø« */
searchInput.oninput=()=>{
  const q=normalize(searchInput.value);
  const filtered=audioFiles.filter(f=>normalize(f.name).includes(q));
  renderAudioList(filtered);
};


/* Ø¥ØºÙ„Ø§Ù‚ */
closeBtn.onclick=()=>{
  audioElem.pause();
  audioElem.src='';
  audioContainer.classList.remove('active');
  setActive(-1);
};

backBtn.onclick=()=>loadContent('');

loadContent();
</script>

</body>
</html>