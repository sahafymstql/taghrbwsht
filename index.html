<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>📚 مكتبة تاغربوشت الديناميكية</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      margin: 0; padding: 20px;
      text-align: center;
    }
    .container {
      margin: auto;
      max-width: 800px;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      margin-bottom: 20px;
    }
    .back {
      margin-bottom: 20px;
      display: inline-block;
      color: #c00;
      cursor: pointer;
      font-weight: bold;
    }
    ul { list-style: none; padding: 0; }
    li {
      background: #eef;
      margin: 8px 0;
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    li:hover {
      background: #cfe6ff;
    }
    audio {
      width: 100%;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>📚 مكتبة تاغربوشت</h1>
    <div id="backButton"></div>
    <audio id="player" controls hidden></audio>
    <ul id="list"></ul>
  </div>

  <script>
    const apiURL = 'https://nujume.com/list_audio.php';
    const listEl = document.getElementById('list');
    const backEl = document.getElementById('backButton');
    const player = document.getElementById('player');
    let currentFolder = '';

    async function load(folder = '') {
      currentFolder = folder;
      const response = await fetch(apiURL + (folder ? `?folder=${encodeURIComponent(folder)}` : ''));
      const items = await response.json();

      listEl.innerHTML = '';
      backEl.innerHTML = folder
        ? `<div class="back" onclick="goBack()">⬅ الرجوع</div>`
        : '';

      items.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item.type === 'folder'
          ? `📁 ${item.name}`
          : `🎵 ${item.name.replace(/\.mp3$/i, '')}`;
        li.onclick = () => {
          if (item.type === 'folder') {
            load(item.path);
          } else {
            player.src = item.url;
            player.hidden = false;
            player.play();
          }
        };
        listEl.appendChild(li);
      });
    }

    function goBack() {
      if (!currentFolder) return;
      const parts = currentFolder.split('/');
      parts.pop();
      load(parts.join('/'));
      player.hidden = true;
    }

    load();
  </script>
</body>
</html>