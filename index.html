<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„ØµÙˆØªÙŠØ©</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>

body{
  font-family: system-ui;
  background:#f7f7f7;
  margin:0;
}

.header{
  padding:10px;
  background:#fff;
  position:sticky;
  top:0;
  z-index:10;
  box-shadow:0 1px 4px rgba(0,0,0,.08);
}

#searchInput{
  width:100%;
  padding:10px;
  border:1px solid #ddd;
  border-radius:8px;
  display:none;
}

#backBtn{
  display:none;
  margin-bottom:8px;
}

.list-container{
  padding:10px;
}

.item-card{
  background:#fff;
  border:1px solid #eee;
  padding:12px;
  border-radius:10px;
  margin-bottom:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  transition:.15s;
}

.item-card:hover{
  background:#fafafa;
}

/* ØªÙ…ÙŠÙŠØ² Ø®ÙÙŠÙ ÙÙ‚Ø· Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ */
.item-card.active{
  background:#eef3ff;
  border-color:#2563eb;
}

.play-button{
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
}

#audioPlayerContainer{
  position:fixed;
  bottom:-120px;
  left:0;
  right:0;
  background:#fff;
  padding:10px;
  box-shadow:0 -2px 10px rgba(0,0,0,.1);
  transition:.25s;
}

#audioPlayerContainer.active{
  bottom:0;
}

.message{
  text-align:center;
  padding:20px;
}

</style>
</head>



<body>

<div class="header">

<button id="backBtn">Ø±Ø¬ÙˆØ¹</button>

<input id="searchInput" placeholder="Ø¨Ø­Ø«...">

</div>

<div id="listContainer" class="list-container"></div>



<div id="audioPlayerContainer">

<div style="display:flex;gap:8px;align-items:center">

<button id="closePlayerBtn">âœ•</button>

<div id="audioFileName" style="flex:1"></div>

</div>

<audio controls style="width:100%"></audio>

</div>



<script>

const apiUrl = 'https://qaryat.xyz/list_audio.php';

const listContainer = document.getElementById('listContainer');
const backBtn = document.getElementById('backBtn');
const searchInput = document.getElementById('searchInput');

const audioContainer = document.getElementById('audioPlayerContainer');
const audioElem = audioContainer.querySelector('audio');
const audioNameElem = document.getElementById('audioFileName');
const closeBtn = document.getElementById('closePlayerBtn');

let currentFolder = '';
let audioFiles = [];
let currentIndex = -1;



/* ===== Ø£Ø¯ÙˆØ§Øª ØµØºÙŠØ±Ø© ===== */

function normalize(s){
  return s.toLowerCase().replace(/[Ø£Ø¥Ø¢]/g,'Ø§');
}

function setActive(index){
  document.querySelectorAll('.item-card')
    .forEach((c,i)=>c.classList.toggle('active', i===index));
}

function naturalSort(arr){
  return arr.sort((a,b)=>
    a.name.localeCompare(b.name,undefined,{
      numeric:true,
      sensitivity:'base'
    })
  );
}



/* ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== */

function loadContent(folder=''){

  currentFolder = folder;

  backBtn.style.display = folder ? 'block':'none';
  searchInput.style.display = folder ? 'block':'none';
  searchInput.value='';

  listContainer.innerHTML='<div class="message">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

  const url = folder ? apiUrl+'?folder='+encodeURIComponent(folder) : apiUrl;

  fetch(url)
  .then(r=>r.json())
  .then(data=>{

    listContainer.innerHTML='';

    if(!data.length){
      listContainer.innerHTML='<div class="message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±</div>';
      return;
    }

    if(!folder){

      data.filter(i=>i.type==='folder').forEach(f=>{
        const div=document.createElement('div');
        div.className='item-card';
        div.textContent='ğŸ“ '+f.name;
        div.onclick=()=>loadContent(f.path);
        listContainer.appendChild(div);
      });

    }else{

      audioFiles = naturalSort(
        data.filter(i=>i.type==='file' && /\.(mp3|wav|ogg)$/i.test(i.name))
      );

      renderAudioList(audioFiles);
    }
  });
}



/* ===== Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ===== */

function renderAudioList(files){

  listContainer.innerHTML='';

  files.forEach((f,index)=>{

    const div=document.createElement('div');
    div.className='item-card';

    div.innerHTML=`
      <span><i class="fa-solid fa-music"></i> ${f.name}</span>
      <button class="play-button"><i class="fa-solid fa-play"></i></button>
    `;

    div.onclick=()=>playAudio(f.url,f.name,index);

    div.querySelector('.play-button').onclick=(e)=>{
      e.stopPropagation();
      playAudio(f.url,f.name,index);
    };

    listContainer.appendChild(div);
  });
}



/* ===== ØªØ´ØºÙŠÙ„ ===== */

function playAudio(url,name,index){

  currentIndex=index;

  audioElem.pause();
  audioElem.currentTime=0;

  audioElem.src=url;
  audioElem.play().catch(()=>{});

  audioNameElem.textContent=name;

  setActive(index);

  audioContainer.classList.add('active');
}



/* ===== Ø§Ù„ØªØ§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ ===== */

audioElem.onended=()=>{
  if(audioFiles[currentIndex+1]){
    const next=audioFiles[currentIndex+1];
    playAudio(next.url,next.name,currentIndex+1);
  }
};



/* ===== Ø¨Ø­Ø« ===== */

searchInput.oninput=()=>{
  const q=normalize(searchInput.value);

  const filtered=audioFiles.filter(f=>
    normalize(f.name).includes(q)
  );

  renderAudioList(filtered);
};



/* ===== Ø¥ØºÙ„Ø§Ù‚ ===== */

closeBtn.onclick=()=>{
  audioElem.pause();
  audioElem.src='';
  audioContainer.classList.remove('active');
  setActive(-1);
};

backBtn.onclick=()=>loadContent('');

loadContent();

</script>

</body>
</html>