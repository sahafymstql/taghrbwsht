<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<title>ğŸ§ Ù…ÙƒØªØ¨Ø© ØªØ§ØºØ±Ø¨ÙˆØ´Øª Ø§Ù„ØµÙˆØªÙŠØ©</title>

<style>
body{
  font-family:'Tajawal',sans-serif;
  background:#f5f7ff;
  margin:0;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

header{
  text-align:center;
  padding:20px;
  background:#2563eb;
  color:#fff;
  font-size:1.6rem;
  font-weight:700;
}

main{
  flex:1;
  padding:12px;
  padding-bottom:120px; /* Ø­ØªÙ‰ Ù„Ø§ ÙŠØºØ·ÙŠ Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
}

#backBtn,#searchInput{
  margin:12px;
  width:calc(100% - 24px);
}

#searchInput{
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  display:none;
}

#listContainer{
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* ===== Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ===== */
.item-card{
  background:#fff;
  border-radius:14px;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border:1px solid #e5e7eb;
  cursor:pointer;
  transition:.2s;
}

.item-card:hover{
  background:#eef3ff;
}

.item-card:active{
  transform:scale(.98); /* Ø¥Ø­Ø³Ø§Ø³ Ø²Ø± Ø­Ù‚ÙŠÙ‚ÙŠ */
}

/* Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø´ØºÙ‘Ù„ */
.item-card.active{
  background:#dbeafe;
  border-color:#2563eb;
}

.play-button{
  min-width:42px;
  min-height:42px;
  border:none;
  border-radius:8px;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
}

/* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
.message{
  text-align:center;
  padding:40px;
  color:#555;
}

/* ===== Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª ===== */
#audioPlayerContainer{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#1d4ed8;
  padding:12px;
  transform:translateY(100%);
  transition:.35s;
  color:#fff;
}

#audioPlayerContainer.active{
  transform:translateY(0);
}

.audio-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
}

audio{
  width:100%;
}
</style>
</head>

<body>

<header>ğŸ§ Ù…ÙƒØªØ¨Ø© ØªØ§ØºØ±Ø¨ÙˆØ´Øª Ø§Ù„ØµÙˆØªÙŠØ©</header>

<button id="backBtn" style="display:none">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
<input id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø«...">

<main>
  <div id="listContainer" class="message">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</main>

<div id="audioPlayerContainer">
  <div class="audio-header">
    <span id="audioFileName"></span>
    <button id="closePlayerBtn">âœ•</button>
  </div>

  <audio controls></audio>
</div>

<script>
const apiUrl='https://qaryat.xyz/list_audio.php';

const listContainer=document.getElementById('listContainer');
const backBtn=document.getElementById('backBtn');
const searchInput=document.getElementById('searchInput');
const audioContainer=document.getElementById('audioPlayerContainer');
const audioElem=audioContainer.querySelector('audio');
const audioNameElem=document.getElementById('audioFileName');
const closeBtn=document.getElementById('closePlayerBtn');

let currentFolder='';
let audioFiles=[];
let currentIndex=-1;


/* ========= Ø£Ø¯ÙˆØ§Øª ØµØºÙŠØ±Ø© ========= */

function normalize(s){
  return s.toLowerCase().replace(/[Ø£Ø¥Ø¢]/g,'Ø§');
}

function setActive(card){
  document.querySelectorAll('.item-card')
    .forEach(c=>c.classList.remove('active'));
  if(card) card.classList.add('active');
}

function saveScroll(){
  sessionStorage.setItem('scroll',window.scrollY);
}

function restoreScroll(){
  window.scrollTo(0,sessionStorage.getItem('scroll')||0);
}


/* ========= ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ========= */

function loadContent(folder=''){
  currentFolder=folder;

  backBtn.style.display=folder?'block':'none';
  searchInput.style.display=folder?'block':'none';

  listContainer.innerHTML='<div class="message">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

  fetch(folder?`${apiUrl}?folder=${encodeURIComponent(folder)}`:apiUrl)
  .then(r=>r.json())
  .then(data=>{
    listContainer.innerHTML='';

    if(!data.length){
      listContainer.innerHTML='<div class="message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ğŸ“‚</div>';
      return;
    }

    if(!folder){
      data.filter(i=>i.type==='folder').forEach(f=>{
        const div=document.createElement('div');
        div.className='item-card';
        div.textContent='ğŸ“ '+f.name;

        div.onclick=()=>loadContent(f.path);
        listContainer.appendChild(div);
      });
    }
    else{
      audioFiles=data.filter(i=>/\.(mp3|wav|ogg)$/i.test(i.name));
      renderAudioList(audioFiles);
    }

    restoreScroll();
  });
}


/* ========= Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ========= */

function renderAudioList(files){
  listContainer.innerHTML='';

  files.forEach((f,index)=>{
    const div=document.createElement('div');
    div.className='item-card';

    const nameSpan=document.createElement('span');
    nameSpan.textContent='ğŸµ '+f.name;

    const btn=document.createElement('button');
    btn.className='play-button';
    btn.textContent='â–¶';

    btn.onclick=(e)=>{
      e.stopPropagation();
      saveScroll();
      playAudio(f,index,div,btn);
    };

    div.append(nameSpan,btn);
    listContainer.appendChild(div);
  });
}


/* ========= ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ========= */

function playAudio(file,index,card,btn){

  document.querySelectorAll('.play-button').forEach(b=>b.textContent='â–¶');

  btn.textContent='â³';

  audioElem.pause();
  audioElem.currentTime=0;
  audioElem.src=file.url;

  audioElem.play().catch(()=>{});

  currentIndex=index;

  setActive(card);
  btn.textContent='â¸';

  audioNameElem.textContent=file.name;
  audioContainer.classList.add('active');
}


/* Ù…Ø¯Ø© Ø§Ù„Ù…Ù„Ù */
audioElem.onloadedmetadata=()=>{
  const d=Math.floor(audioElem.duration);
  const m=Math.floor(d/60);
  const s=(d%60).toString().padStart(2,'0');
  audioNameElem.textContent+=` (${m}:${s})`;
};


/* ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ */
audioElem.onended=()=>{
  if(audioFiles[currentIndex+1]){
    const next=audioFiles[currentIndex+1];
    const cards=document.querySelectorAll('.item-card');
    playAudio(next,currentIndex+1,cards[currentIndex+1],
      cards[currentIndex+1].querySelector('button'));
  }
};


/* Ø¥ØºÙ„Ø§Ù‚ */
closeBtn.onclick=()=>{
  audioElem.pause();
  audioElem.src='';
  audioContainer.classList.remove('active');
};


/* Ø¨Ø­Ø« Ø°ÙƒÙŠ */
searchInput.oninput=()=>{
  const q=normalize(searchInput.value);
  const filtered=audioFiles.filter(f=>normalize(f.name).includes(q));
  renderAudioList(filtered);
};


backBtn.onclick=()=>loadContent('');

loadContent();
</script>

</body>
</html>