<?php
// Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„Ù„ØªØµØ­ÙŠØ­ (ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ù‡Ø°Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§)
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª
$directory = "/home/nujusqfr/qaryat.xyz/wp-content/uploads/Ø¨Ø§Ù„Ø¹Ù„Ù… Ù†Ø±ØªÙ‚ÙŠ";

// Ø§Ù„ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù…ÙˆØ¬ÙˆØ¯
if (!is_dir($directory)) {
    die("Ø§Ù„Ù…Ø¬Ù„Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: $directory");
}

// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª
$files = glob($directory . "/*.mp3");
?>

<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙˆØ§Øª</title>

<style>
    body {
        font-family: "Tajawal", sans-serif;
        background: #f5f6fa;
        margin: 0;
        padding: 20px;
        direction: rtl;
        text-align: right;
    }

    h2 {
        text-align: center;
        color: #333;
        margin-bottom: 25px;
    }

    .audio-card {
        background: #ffffff;
        padding: 15px;
        border-radius: 14px;
        margin-bottom: 15px;
        box-shadow: 0 2px 7px rgba(0,0,0,0.10);
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: transform .2s;
    }

    .audio-card:hover {
        transform: scale(1.02);
    }

    .audio-title {
        font-size: 17px;
        font-weight: 600;
        color: #2c3e50;
    }

    .play-btn {
        background: #0984e3;
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: background .2s;
        font-size: 15px;
    }

    .play-btn:hover {
        background: #74b9ff;
    }
</style>
</head>
<body>

<h2>ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª</h2>

<?php foreach ($files as $index => $file):
    $filename = basename($file);
?>
<div class="audio-card">
    <div class="audio-title"><?= htmlspecialchars($filename) ?></div>

    <button class="play-btn" onclick="togglePlay(<?= $index ?>)" id="btn-<?= $index ?>">â–¶ ØªØ´ØºÙŠÙ„</button>

    <audio id="audio-<?= $index ?>">
        <source src="/wp-content/uploads/Ø¨Ø§Ù„Ø¹Ù„Ù… Ù†Ø±ØªÙ‚ÙŠ/<?= $filename ?>" type="audio/mpeg">
    </audio>
</div>
<?php endforeach; ?>

<script>
    let currentPlaying = null;

    function togglePlay(i) {
        let audio = document.getElementById("audio-" + i);
        let btn = document.getElementById("btn-" + i);

        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙØ³ Ø§Ù„ØµÙˆØª ÙŠÙØ´ØºÙ‘Ù„ â†’ ÙˆÙ‚Ù‘ÙÙ‡
        if (currentPlaying === i) {
            audio.pause();
            audio.currentTime = 0;
            btn.textContent = "â–¶ ØªØ´ØºÙŠÙ„";
            currentPlaying = null;
            return;
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØµÙˆØª Ø¢Ø®Ø± Ø´ØºÙ‘Ø§Ù„
        if (currentPlaying !== null) {
            let oldAudio = document.getElementById("audio-" + currentPlaying);
            let oldBtn = document.getElementById("btn-" + currentPlaying);

            oldAudio.pause();
            oldAudio.currentTime = 0;
            oldBtn.textContent = "â–¶ ØªØ´ØºÙŠÙ„";
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠ
        audio.play();
        btn.textContent = "â¸ Ø¥ÙŠÙ‚Ø§Ù";
        currentPlaying = i;

        // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙˆØª ÙŠØ±Ø¬Ø¹ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        audio.onended = function () {
            btn.textContent = "â–¶ ØªØ´ØºÙŠÙ„";
            currentPlaying = null;
        };
    }
</script>

</body>
</html>